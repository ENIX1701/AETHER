services:
    shadow:
        build:
            context: SHADOW/
            dockerfile: Dockerfile
        image: shadow:latest
        container_name: shadow
        ports:
            - "9999:9999"
        volumes:
            - ./GHOST:/usr/src/GHOST:ro
            - shadow-builds:/home/shadowuser/builds
        environment:
            - GHOST_SOURCE_PATH=/usr/src/GHOST
        restart: unless-stopped

    charon:
        build:
            context: CHARON/
            dockerfile: Dockerfile
        image: charon:latest
        container_name: charon
        stdin_open: true
        tty: true
        environment:
            - SHADOW_URL=http://shadow
            - SHADOW_PORT=9999
        restart: unless-stopped

    ghost:
        build:
            context: GHOST/
            dockerfile: Dockerfile
        depends_on:
            - shadow
        environment:
            - SHADOW_URL=shadow
            - SHADOW_PORT=9999

volumes:
    shadow-builds:
